<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduGen AI - Smart Context Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f1f5f9; scroll-behavior: smooth; }
        
        /* ë‹¨ê³„ë³„ í™”ë©´ ì „í™˜ */
        .step-content { display: none; }
        .step-content.active { display: flex; animation: slideIn 0.4s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* ìŠ¤íƒ€ì¼ ì¹´ë“œ */
        .style-card { border: 3px solid transparent; cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden; }
        .style-card.selected { border-color: #4f46e5; background: #eef2ff; transform: translateY(-5px); box-shadow: 0 10px 25px -5px rgba(79, 70, 229, 0.3); }
        .style-card.selected::after { content: 'âœ“'; position: absolute; top: 12px; right: 12px; background: #4f46e5; color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        
        /* íƒ­ ë²„íŠ¼ */
        .tab-btn { border-bottom: 3px solid transparent; color: #94a3b8; transition: all 0.2s; }
        .tab-btn.active-tab { border-color: #4f46e5; color: #4f46e5; font-weight: 800; }
        
        /* ì…ë ¥ í¼ */
        .input-group label { display: block; font-size: 0.75rem; font-weight: 800; color: #64748b; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .input-group input, .input-group select { width: 100%; padding: 0.75rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 0.75rem; font-weight: 600; outline: none; transition: 0.2s; }
        .input-group input:focus, .input-group select:focus { border-color: #6366f1; background: white; ring: 2px solid #e0e7ff; }
        
        /* ì±„íŒ… ë§í’ì„  */
        .chat-bubble { max-width: 85%; padding: 1.2rem; border-radius: 1.5rem; margin-bottom: 1rem; position: relative; line-height: 1.6; font-size: 1.05rem; }
        .ai-bubble { background: #eef2ff; color: #3730a3; border-bottom-left-radius: 0.2rem; }
        .user-bubble { background: #4f46e5; color: white; border-bottom-right-radius: 0.2rem; align-self: flex-end; box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3); }

        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #4f46e5; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* íˆìŠ¤í† ë¦¬ ì¸ë„¤ì¼ */
        .history-item { 
            width: 100px; height: 100px; flex-shrink: 0; border-radius: 1rem; overflow: hidden; 
            border: 3px solid transparent; cursor: pointer; transition: all 0.2s; position: relative;
            background-color: #e2e8f0;
        }
        .history-item img { width: 100%; height: 100%; object-fit: cover; }
        .history-item:hover { transform: translateY(-3px); }
        .history-item.active-version { border-color: #4f46e5; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }
        .history-item .badge { 
            position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.6); 
            color: white; font-size: 10px; text-align: center; padding: 4px 0; 
            backdrop-filter: blur(2px);
        }

        /* ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜ */
        .modal-enter { animation: modalIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes modalIn { 
            from { opacity: 0; transform: scale(0.95); } 
            to { opacity: 1; transform: scale(1); } 
        }
    </style>
</head>
<body class="text-slate-900 overflow-x-hidden min-h-screen flex flex-col relative">

    <header class="w-full bg-white/80 backdrop-blur-md border-b px-12 py-4 flex justify-between items-center sticky top-0 z-40">
        <div class="flex items-center gap-3 cursor-pointer group" onclick="location.reload()">
            <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white font-black text-xl group-hover:rotate-12 transition-transform">E</div>
            <h1 class="text-2xl font-black text-slate-800 tracking-tight">EduGen <span class="text-indigo-600">AI</span></h1>
        </div>
        <nav class="flex items-center gap-2">
            <div id="nav1" class="px-4 py-2 rounded-full text-xs font-bold bg-indigo-600 text-white transition-all">1. ìŠ¤íƒ€ì¼/ê·œê²©</div>
            <div class="w-8 h-[2px] bg-slate-200"></div>
            <div id="nav2" class="px-4 py-2 rounded-full text-xs font-bold text-slate-400 bg-slate-100 transition-all">2. í”„ë¡¬í”„íŠ¸</div>
            <div class="w-8 h-[2px] bg-slate-200"></div>
            <div id="nav3" class="px-4 py-2 rounded-full text-xs font-bold text-slate-400 bg-slate-100 transition-all">3. ìƒì„±/í™•ì¸</div>
            <div class="w-8 h-[2px] bg-slate-200"></div>
            <div id="nav4" class="px-4 py-2 rounded-full text-xs font-bold text-slate-400 bg-slate-100 transition-all">4. ìŠ¤íŠœë””ì˜¤(ìˆ˜ì •)</div>
            <div class="w-8 h-[2px] bg-slate-200"></div>
            <div id="nav5" class="px-4 py-2 rounded-full text-xs font-bold text-slate-400 bg-slate-100 transition-all">5. ì™„ë£Œ</div>
        </nav>
    </header>

    <main class="flex-1 p-8 max-w-[1400px] mx-auto w-full pb-32">

        <div id="step1" class="step-content active flex-col gap-8">
            <div class="text-center mb-6">
                <span class="text-indigo-600 font-bold tracking-widest text-xs uppercase mb-2 block">Step 1 of 5</span>
                <h2 class="text-4xl font-black mb-3">ì–´ë–¤ ìŠ¤íƒ€ì¼ì˜ ì´ë¯¸ì§€ê°€ í•„ìš”í•˜ì‹ ê°€ìš”?</h2>
                <p class="text-slate-500 text-lg">êµì¬ì˜ ì„±ê²©ì— ë§ëŠ” í™”í’ê³¼ ì¸ì‡„ ê·œê²©ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.</p>
            </div>
            
            <div class="grid grid-cols-4 gap-6">
                <div onclick="selectStyle(this, 'Photorealistic, 8k, highly detailed')" class="style-card bg-white p-4 rounded-[2rem] shadow-sm hover:shadow-xl selected">
                    <img src="https://picsum.photos/seed/nature/600/450" class="rounded-2xl w-full aspect-[4/3] object-cover mb-4">
                    <h4 class="font-bold text-center text-lg">ì‹¤ì‚¬ ì‚¬ì§„</h4>
                </div>
                <div onclick="selectStyle(this, 'Flat vector art, clean lines, minimal')" class="style-card bg-white p-4 rounded-[2rem] shadow-sm hover:shadow-xl">
                    <img src="https://picsum.photos/seed/art/600/450" class="rounded-2xl w-full aspect-[4/3] object-cover mb-4">
                    <h4 class="font-bold text-center text-lg">í•™ìŠµ ì¼ëŸ¬ìŠ¤íŠ¸</h4>
                </div>
                <div onclick="selectStyle(this, 'Watercolor painting, soft pastel colors, artistic')" class="style-card bg-white p-4 rounded-[2rem] shadow-sm hover:shadow-xl">
                    <img src="https://picsum.photos/seed/paint/600/450" class="rounded-2xl w-full aspect-[4/3] object-cover mb-4">
                    <h4 class="font-bold text-center text-lg">ë¶€ë“œëŸ¬ìš´ ìˆ˜ì±„í™”</h4>
                </div>
                <div onclick="selectStyle(this, 'Technical diagram, schematic, blueprint style, colorful')" class="style-card bg-white p-4 rounded-[2rem] shadow-sm hover:shadow-xl">
                    <img src="https://picsum.photos/seed/tech/600/450" class="rounded-2xl w-full aspect-[4/3] object-cover mb-4">
                    <h4 class="font-bold text-center text-lg">ê°œë… ë‹¤ì´ì–´ê·¸ë¨</h4>
                </div>
            </div>

            <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100 flex gap-8 items-end">
                <div class="input-group flex-1">
                    <label>ì¶œë ¥ ë¹„ìœ¨ (Aspect Ratio)</label>
                    <select id="aspectRatio" class="text-lg py-3 cursor-pointer hover:border-indigo-400">
                        <option value="1:1">1:1 (ì •ì‚¬ê°í˜•)</option>
                        <option value="4:3" selected>4:3 (í‘œì¤€ êµì¬)</option>
                        <option value="16:9">16:9 (ì™€ì´ë“œ)</option>
                        <option value="2:3">2:3 (ì„¸ë¡œí˜•)</option>
                    </select>
                </div>
                <div class="input-group flex-1">
                    <label>ìµœì¢… í•´ìƒë„</label>
                    <select class="text-lg py-3 cursor-pointer hover:border-indigo-400">
                        <option>Standard (72DPI - ì›¹ìš©)</option>
                        <option selected>Print High-Res (300DPI - ì¸ì‡„ìš©)</option>
                        <option>Ultra-HD (600DPI - ëŒ€í˜• ì‹¤ì‚¬)</option>
                    </select>
                </div>
            </div>

            <button onclick="nextStep(2)" class="w-full py-5 bg-slate-900 text-white rounded-2xl font-bold text-xl shadow-lg hover:bg-black hover:scale-[1.01] transition transform">ë‹¤ìŒ ë‹¨ê³„ë¡œ (ì…ë ¥ ë°©ì‹ ì„ íƒ) â†’</button>
        </div>

        <div id="step2" class="step-content flex-col gap-6">
            <div class="text-center mb-2">
                <span class="text-indigo-600 font-bold tracking-widest text-xs uppercase mb-2 block">Step 2 of 5</span>
                <h2 class="text-4xl font-black mb-2">ì›í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ ë¬˜ì‚¬í•´ì£¼ì„¸ìš”</h2>
            </div>
            
            <div class="flex border-b-2 border-slate-200 mb-2">
                <button onclick="switchTab('free')" id="tab-free" class="tab-btn active-tab flex-1 py-4 text-lg font-bold">ğŸ’¬ ììœ  ëŒ€í™” ëª¨ë“œ</button>
                <button onclick="switchTab('structured')" id="tab-structured" class="tab-btn flex-1 py-4 text-lg font-bold">ğŸ“‹ ìƒì„¸ í•­ëª© ì…ë ¥</button>
            </div>

            <div id="content-free" class="flex flex-col gap-4 h-[600px]">
                <div class="bg-slate-50 rounded-[2.5rem] p-8 flex-1 overflow-y-auto flex flex-col gap-4 border border-slate-200 shadow-inner" id="chatWindow">
                    <div class="chat-bubble ai-bubble">
                        ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”! ì„¤ì •í•˜ì‹  ìŠ¤íƒ€ì¼ë¡œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•´ë“œë¦´ê²Œìš”.<br>
                        ì–´ë–¤ ì´ë¯¸ì§€ê°€ í•„ìš”í•˜ì‹ ê°€ìš”? (ì˜ˆ: "ëˆˆ ë‚´ë¦¬ëŠ” ìˆ²ì†ì˜ ì˜¤ë‘ë§‰")
                    </div>
                </div>
                <div class="relative mt-2">
                    <textarea id="freeInput" class="w-full p-6 pr-32 bg-white border-2 border-indigo-100 rounded-[2rem] text-xl shadow-lg outline-none focus:border-indigo-500 h-24 resize-none transition-all" placeholder="ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”..." onkeydown="if(event.keyCode==13 && !event.shiftKey) {event.preventDefault(); sendMessage();}"></textarea>
                    <button onclick="sendMessage()" class="absolute right-3 top-3 bottom-3 px-8 bg-indigo-600 text-white rounded-[1.5rem] font-bold hover:bg-indigo-700 transition shadow-md">ì „ì†¡</button>
                </div>
            </div>

            <div id="content-structured" class="hidden bg-white p-10 rounded-[2.5rem] border shadow-sm">
                <div class="grid grid-cols-4 gap-6 mb-8">
                    <div class="input-group"><label>1. í”¼ì‚¬ì²´</label><input type="text" id="s_subject" placeholder="ì˜ˆ: ë‹¤ëŒì¥"></div>
                    <div class="input-group"><label>2. ë™ì‘</label><input type="text" id="s_action" placeholder="ì˜ˆ: ë„í† ë¦¬ë¥¼ ë¨¹ëŠ”"></div>
                    <div class="input-group"><label>3. í‘œì •</label><input type="text" id="s_expression" placeholder="ì˜ˆ: í–‰ë³µí•œ"></div>
                    <div class="input-group"><label>4. ì‹œì„ </label><select id="s_gaze"><option>ì •ë©´ ì‘ì‹œ</option><option>ë¨¼ ê³³ ë³´ê¸°</option></select></div>
                </div>
                <div class="grid grid-cols-4 gap-6">
                    <div class="input-group"><label>5. ì¥ì†Œ</label><input type="text" id="s_location" placeholder="ì˜ˆ: ìˆ²ì†"></div>
                    <div class="input-group"><label>6. ë¶„ìœ„ê¸°</label><input type="text" id="s_mood" placeholder="ì˜ˆ: í™”ì°½í•œ"></div>
                </div>
            </div>

            <button id="finalGenBtn" onclick="nextStep(3)" class="hidden w-full py-5 bg-gradient-to-r from-indigo-600 to-blue-600 text-white rounded-2xl font-black text-xl shadow-xl hover:shadow-2xl transition transform hover:-translate-y-1">âœ¨ ì‹¤ì œ AI ì´ë¯¸ì§€ ìƒì„± ì‹œì‘</button>
        </div>

        <div id="step3" class="step-content flex-col gap-8">
            <h2 class="text-3xl font-black">3ë‹¨ê³„. ìƒì„± ê²°ê³¼ í™•ì¸</h2>
            <div class="grid grid-cols-2 gap-10 h-[600px]">
                
                <div class="relative group w-full h-full bg-slate-100 rounded-[2.5rem] overflow-hidden shadow-inner flex items-center justify-center">
                    <div id="imageLoading" class="absolute inset-0 bg-slate-900/90 z-20 flex flex-col items-center justify-center text-white transition-opacity duration-300">
                        <div class="loader mb-6 border-t-indigo-400"></div>
                        <h3 id="loadingText" class="text-xl font-bold tracking-widest animate-pulse uppercase">Generating with AI...</h3>
                        <p class="text-sm mt-4 text-slate-400">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” (ì•½ 5~10ì´ˆ)</p>
                    </div>
                    
                    <img id="resultImage" src="" crossorigin="anonymous" class="w-full h-full object-contain bg-slate-800 transition-transform duration-700 hover:scale-105">
                </div>

                <div class="flex flex-col justify-center h-full gap-6">
                    <div class="bg-white p-8 rounded-[2rem] border border-slate-100 shadow-sm">
                        <h4 class="text-indigo-600 font-bold mb-6 uppercase text-xs tracking-widest flex items-center gap-2">
                            <span class="w-2 h-2 bg-indigo-600 rounded-full animate-pulse"></span> AI Generation Report
                        </h4>
                        <div class="space-y-4 text-lg text-slate-700">
                            <div class="flex justify-between border-b border-slate-100 pb-3"><span>ëª¨ë¸ ì—”ì§„</span><span class="font-bold text-indigo-600">Pollinations AI</span></div>
                            <div class="flex justify-between border-b border-slate-100 pb-3"><span>ì¸ì‡„ ì í•©ì„±</span><span class="text-emerald-500 font-bold flex items-center gap-1">Pass (300DPI) âœ“</span></div>
                            <div class="flex justify-between"><span>ìƒíƒœ</span><span class="font-bold">Generation Complete</span></div>
                        </div>
                    </div>

                    <div class="bg-slate-50 rounded-[2rem] p-6 border border-slate-200 shadow-inner">
                        <p class="text-sm font-bold text-slate-500 mb-4 flex items-center gap-2">ğŸ¤” ê²°ê³¼ê°€ ë§ˆìŒì— ë“¤ì§€ ì•Šìœ¼ì‹ ê°€ìš”?</p>
                        <div class="flex gap-3 mb-4">
                            <button onclick="regenerateImage(false)" class="flex-1 py-4 bg-white border-2 border-slate-200 text-slate-600 rounded-2xl font-bold hover:border-indigo-400 hover:text-indigo-600 transition flex items-center justify-center gap-2 shadow-sm">
                                <span class="text-xl">ğŸ”„</span> ë‹¤ë¥¸ êµ¬ë„ë¡œ (Re-roll)
                            </button>
                        </div>
                    </div>

                    <button onclick="nextStep(4)" class="w-full py-5 bg-indigo-600 text-white rounded-[2rem] font-black text-xl shadow-xl hover:bg-indigo-700 transition transform hover:scale-[1.02] flex items-center justify-center gap-2 group">
                        ìŠ¤íŠœë””ì˜¤ì—ì„œ ìˆ˜ì • ë° í™•ì •í•˜ê¸° 
                        <span class="group-hover:translate-x-1 transition-transform">â†’</span>
                    </button>
                </div>
            </div>
        </div>

        <div id="step4" class="step-content flex-col gap-6 h-auto min-h-[700px]">
            <div class="flex justify-between items-end">
                <div>
                    <h2 class="text-3xl font-black">4ë‹¨ê³„. ìŠ¤íŠœë””ì˜¤ (í¸ì§‘ ë° ì €ì¥)</h2>
                    <p class="text-slate-500 mt-2">ì›í•˜ëŠ” ë¶€ë¶„ë§Œ ìˆ˜ì •í•˜ì—¬ ì—¬ëŸ¬ ë²„ì „ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.</p>
                </div>
                <span class="text-sm text-indigo-600 font-bold bg-indigo-50 px-3 py-1 rounded-full">ğŸ’¡ í•˜ë‹¨ ì¸ë„¤ì¼ì„ í´ë¦­í•˜ì—¬ ì–¸ì œë“  ì´ì „ ì‹œì ìœ¼ë¡œ ëŒì•„ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
            </div>
        
            <div class="flex gap-8 h-[500px]">
                <div class="flex-[2] bg-slate-900 rounded-[2rem] border-2 border-slate-200 relative flex items-center justify-center overflow-hidden group">
                    <img id="inpaintingImage" src="" class="max-w-full max-h-full object-contain shadow-lg transition-transform duration-300">
                    
                    <button onclick="openDownloadModal()" class="absolute top-4 right-4 bg-white/90 backdrop-blur text-slate-900 px-4 py-2 rounded-xl font-bold shadow-md hover:bg-indigo-600 hover:text-white transition text-sm flex items-center gap-2">
                        <span>ğŸ’¾</span> ë‹¤ìš´ë¡œë“œ (í˜•ì‹ ì„ íƒ)
                    </button>
                </div>
                
                <div class="flex-1 flex flex-col gap-4">
                    <div class="bg-white p-6 rounded-[2rem] border shadow-sm flex-1 flex flex-col">
                        <label class="text-xs font-bold text-slate-400 uppercase mb-2 flex justify-between">
                            Edit Request
                            <span class="text-indigo-500">In-painting</span>
                        </label>
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-200 mb-4 flex-1">
                            <p class="text-sm text-slate-500 mb-2 font-bold">ìˆ˜ì • ê°€ì´ë“œ:</p>
                            <ul class="text-xs text-slate-400 list-disc list-inside space-y-1 mb-4">
                                <li>í˜„ì¬ ë³´ê³  ìˆëŠ” ì´ë¯¸ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤.</li>
                                <li>"ê³ ì–‘ì´ë§Œ ë‚¨ê¸°ê³  ë°°ê²½ ì§€ì›Œì¤˜"</li>
                                <li>"ë°°ê²½ì„ ë°¤ìœ¼ë¡œ ë°”ê¿”ì¤˜"</li>
                            </ul>
                            <textarea id="editInput" class="w-full h-24 bg-white border border-slate-200 rounded-xl p-3 text-sm resize-none focus:outline-none focus:border-indigo-500" 
                            placeholder="ìˆ˜ì •í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                        </div>
                        <button onclick="applyEdit()" id="btnApplyEdit" class="w-full py-4 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 shadow-md transition flex items-center justify-center gap-2">
                            âœ¨ ìƒˆ ë²„ì „ ìƒì„± (Generate)
                        </button>
                    </div>
                    <button onclick="nextStep(5)" class="py-4 bg-slate-800 text-white rounded-2xl font-bold hover:bg-black transition">
                        ì‘ì—… ì¢…ë£Œ â†’
                    </button>
                </div>
            </div>
        
            <div class="w-full bg-white p-4 rounded-[1.5rem] border border-slate-200 shadow-sm">
                <p class="text-xs font-bold text-slate-400 uppercase mb-2 ml-1">Session History</p>
                <div class="flex gap-4 items-center overflow-x-auto pb-2 scrollbar-hide" id="historyContainer">
                    </div>
            </div>
        </div>

        <div id="step5" class="step-content flex-col items-center justify-center text-center py-10 gap-8">
            <div class="w-28 h-28 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center text-5xl shadow-xl animate-[bounce_1s_infinite]">âœ“</div>
            <div class="space-y-2">
                <h2 class="text-4xl font-black tracking-tighter text-slate-800">ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
                <p class="text-xl text-slate-400 font-medium">ë‹¤ìš´ë¡œë“œ í´ë”ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
            </div>
            <button onclick="location.reload()" class="mt-4 px-8 py-3 rounded-full text-slate-500 font-bold hover:bg-slate-200 transition">ìƒˆë¡œìš´ ì‘ì—… ì‹œì‘í•˜ê¸° â†º</button>
        </div>

    </main>

    <div id="downloadModal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeDownloadModal()"></div>
        
        <div class="bg-white rounded-[2.5rem] p-8 w-[500px] relative z-10 shadow-2xl modal-enter">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-black text-slate-800">ë‹¤ìš´ë¡œë“œ ì˜µì…˜ ì„ íƒ</h3>
                <button onclick="closeDownloadModal()" class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 hover:bg-slate-200">âœ•</button>
            </div>
            
            <p class="text-slate-500 mb-6">ì‚¬ìš© ëª©ì ì— ë§ëŠ” íŒŒì¼ í˜•ì‹ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
            
            <div class="grid gap-4 mb-8">
                <button onclick="executeDownload('jpg')" class="group flex items-center gap-4 p-4 border-2 border-slate-100 rounded-2xl hover:border-indigo-500 hover:bg-indigo-50 transition text-left">
                    <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-xl flex items-center justify-center font-black text-xs">JPG</div>
                    <div>
                        <div class="font-bold text-slate-800 group-hover:text-indigo-700">ì›¹/ëª¨ë°”ì¼ìš© (Standard)</div>
                        <div class="text-xs text-slate-400">íŒŒì¼ ìš©ëŸ‰ì´ ì‘ì•„ ê³µìœ í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤.</div>
                    </div>
                </button>

                <button onclick="executeDownload('png')" class="group flex items-center gap-4 p-4 border-2 border-slate-100 rounded-2xl hover:border-indigo-500 hover:bg-indigo-50 transition text-left">
                    <div class="w-12 h-12 bg-emerald-100 text-emerald-600 rounded-xl flex items-center justify-center font-black text-xs">PNG</div>
                    <div>
                        <div class="font-bold text-slate-800 group-hover:text-indigo-700">ì¸ì‡„/ê³ í™”ì§ˆìš© (High-Res)</div>
                        <div class="text-xs text-slate-400">ì••ì¶• ì†ì‹¤ ì—†ëŠ” ì„ ëª…í•œ í™”ì§ˆì…ë‹ˆë‹¤.</div>
                    </div>
                </button>

                <button onclick="executeDownload('ai')" class="group flex items-center gap-4 p-4 border-2 border-slate-100 rounded-2xl hover:border-indigo-500 hover:bg-indigo-50 transition text-left">
                    <div class="w-12 h-12 bg-orange-100 text-orange-600 rounded-xl flex items-center justify-center font-black text-xs">AI</div>
                    <div>
                        <div class="font-bold text-slate-800 group-hover:text-indigo-700">í¸ì§‘ ì›ë³¸ ë°ì´í„° (Project)</div>
                        <div class="text-xs text-slate-400">ê³ í•´ìƒë„ ì›ë³¸ + í”„ë¡¬í”„íŠ¸ ì •ë³´ í¬í•¨</div>
                    </div>
                </button>
            </div>

            <div class="text-center">
                <span class="text-xs text-slate-400 font-medium">âœ¨ EduGen AI Safe License Applied</span>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentStep = 1;
        let selectedStyle = 'Photorealistic, 8k, highly detailed'; 
        let finalPrompt = ""; 
        let imageHistory = []; 
        let currentHistoryIndex = -1;

        console.log("EduGen AI Script Loaded Successfully");

        // 1. ë‹¨ê³„ ì´ë™ í•¨ìˆ˜ (ìµœìƒë‹¨ ë°°ì¹˜ë¡œ í˜¸ì¶œ ë³´ì¥)
        function nextStep(n) {
            currentStep = n;
            document.querySelectorAll('.step-content').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + n).classList.add('active');
            updateNav(n);

            if(n === 3) {
                generateImageWithPollinations();
            }
            
            // Step 4 ì§„ì… ì‹œ ì´ˆê¸°í™” ë¡œì§
            if(n === 4) {
                const imgElem = document.getElementById('resultImage');
                // ì´ë¯¸ì§€ê°€ ë¡œë“œëœ ìƒíƒœì¸ì§€ í™•ì¸
                if (imgElem.src && imgElem.src !== window.location.href) {
                     if (imageHistory.length === 0) {
                        addToHistory(imgElem.src, "ì›ë³¸ (Original)");
                    }
                }
                renderHistory();
            }
            window.scrollTo(0, 0);
        }

        // 2. ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸
        function updateNav(n) {
            for(let i=1; i<=5; i++) {
                const nav = document.getElementById('nav'+i);
                if(i === n) nav.className = "px-4 py-2 rounded-full text-xs font-bold bg-indigo-600 text-white shadow-lg transition-all";
                else if (i < n) nav.className = "px-4 py-2 rounded-full text-xs font-bold bg-indigo-50 text-indigo-600 transition-all";
                else nav.className = "px-4 py-2 rounded-full text-xs font-bold text-slate-400 bg-slate-100 transition-all";
            }
        }

        // 3. ìŠ¤íƒ€ì¼ ì„ íƒ
        function selectStyle(el, styleKeyword) {
            document.querySelectorAll('.style-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            selectedStyle = styleKeyword;
        }

        // 4. íƒ­ ì „í™˜
        function switchTab(mode) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab'));
            document.getElementById('tab-'+mode).classList.add('active-tab');
            document.getElementById('content-free').classList.toggle('hidden', mode === 'structured');
            document.getElementById('content-structured').classList.toggle('hidden', mode === 'free');
            if(mode === 'structured') document.getElementById('finalGenBtn').classList.remove('hidden');
        }

        // 5. ì±„íŒ… ë©”ì‹œì§€ ì²˜ë¦¬ (í”¼ë“œë°± ë¡œì§ í¬í•¨)
        function sendMessage() {
            const input = document.getElementById('freeInput');
            const chatWindow = document.getElementById('chatWindow');
            const userText = input.value.trim();
            
            if(!userText) return;

            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            chatWindow.innerHTML += `<div class="chat-bubble user-bubble">${userText}</div>`;
            input.value = "";
            chatWindow.scrollTop = chatWindow.scrollHeight;

            // [í•µì‹¬] ì…ë ¥ì´ 6ê¸€ì ë¯¸ë§Œì¼ ê²½ìš° ì¶”ê°€ ì •ë³´ ìš”ì²­
            if (userText.length < 6) {
                setTimeout(() => {
                    const feedbackResponse = `
                        <div class="chat-bubble ai-bubble bg-indigo-50 border border-indigo-100">
                            <strong>ğŸ§ ì •ë³´ê°€ ë” í•„ìš”í•´ìš”!</strong><br>
                            "${userText}"ì— ëŒ€í•œ ì™„ë²½í•œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ì•„ë˜ ì •ë³´ë¥¼ ì¡°ê¸ˆ ë” ì•Œë ¤ì£¼ì„¸ìš”:<br><br>
                            <ul class="list-disc list-inside text-sm space-y-2 text-slate-700 bg-white p-4 rounded-xl shadow-sm">
                                <li><strong>í–‰ë™, í¬ì¦ˆ</strong></li>
                                <li><strong>ë°°ê²½, ì¥ì†Œ</strong></li>
                                <li><strong>ë¶„ìœ„ê¸°, ê°ì •</strong></li>
                                <li><strong>ìƒ‰ê°</strong></li>
                                <li><strong>í™”ë©´ ë¹„ìœ¨ (ì˜ˆ: 1:1, 4:3)</strong></li>
                            </ul>
                        </div>
                    `;
                    chatWindow.innerHTML += feedbackResponse;
                    chatWindow.scrollTop = chatWindow.scrollHeight;
                }, 600);
                return; // ìƒì„± ë²„íŠ¼ í™œì„±í™” ì•ˆ í•¨
            }

            // ì •ìƒ ì…ë ¥ ì‹œ ì§„í–‰
            finalPrompt = userText; 
            setTimeout(() => {
                const aiResponse = `
                    <div class="chat-bubble ai-bubble">
                        <strong>âœ… ë‚´ìš© í™•ì¸!</strong><br>
                        "${finalPrompt}" ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>
                        ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìƒì„±ì„ ì‹œì‘í•´ì£¼ì„¸ìš”.
                    </div>
                `;
                chatWindow.innerHTML += aiResponse;
                chatWindow.scrollTop = chatWindow.scrollHeight;
                document.getElementById('finalGenBtn').classList.remove('hidden');
            }, 600);
        }

        // 6. ì´ë¯¸ì§€ ìƒì„± (Pollinations AI)
        function regenerateImage(isTweak) {
            generateImageWithPollinations();
        }

        function generateImageWithPollinations() {
            const loader = document.getElementById('imageLoading');
            const img = document.getElementById('resultImage');
            
            loader.style.display = 'flex';
            setTimeout(() => loader.style.opacity = '1', 10);
            
            const ratioVal = document.getElementById('aspectRatio').value;
            let width = 1024, height = 1024;
            if(ratioVal === '4:3') { width = 1024; height = 768; }
            else if(ratioVal === '16:9') { width = 1024; height = 576; }
            else if(ratioVal === '2:3') { width = 768; height = 1152; }

            if(!finalPrompt) {
                const s1 = document.getElementById('s_subject').value;
                const s2 = document.getElementById('s_action').value;
                const s3 = document.getElementById('s_location').value;
                if(s1 || s2) finalPrompt = `${s1} ${s2} in ${s3}`;
                else finalPrompt = "Cute educational character illustration"; 
            }

            const combinedPrompt = `${selectedStyle}, ${finalPrompt}, high quality, educational illustration, detailed, 8k`;
            const encodedPrompt = encodeURIComponent(combinedPrompt);
            const randomSeed = Math.floor(Math.random() * 99999);

            const imageUrl = `https://image.pollinations.ai/prompt/${encodedPrompt}?width=${width}&height=${height}&seed=${randomSeed}&nologo=true&model=flux`;

            img.onload = function() {
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                }, 300);
            };
            
            img.crossOrigin = "Anonymous";
            img.src = imageUrl;
        }

        // 7. íˆìŠ¤í† ë¦¬ ê´€ë¦¬
        function addToHistory(url, label) {
            const newEntry = {
                url: url,
                label: label,
                timestamp: new Date().getTime()
            };
            imageHistory.push(newEntry);
            currentHistoryIndex = imageHistory.length - 1;
            updateCanvas();
            renderHistory();
        }

        function updateCanvas() {
            const currentImg = imageHistory[currentHistoryIndex];
            document.getElementById('inpaintingImage').src = currentImg.url;
            
            document.querySelectorAll('.history-item').forEach((el, idx) => {
                if(idx === currentHistoryIndex) el.classList.add('active-version');
                else el.classList.remove('active-version');
            });
        }

        function loadHistory(index) {
            currentHistoryIndex = index;
            updateCanvas();
        }

        function renderHistory() {
            const container = document.getElementById('historyContainer');
            container.innerHTML = ''; 

            imageHistory.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = `history-item ${index === currentHistoryIndex ? 'active-version' : ''}`;
                div.onclick = () => loadHistory(index);
                
                div.innerHTML = `
                    <img src="${item.url}">
                    <div class="badge">${item.label}</div>
                `;
                container.appendChild(div);
            });
        }

        // 8. ìŠ¤íŠœë””ì˜¤ ìˆ˜ì • (In-painting Simulation)
        function applyEdit() {
            const input = document.getElementById('editInput');
            if(!input.value.trim()) return;
            
            const btn = document.getElementById('btnApplyEdit');
            const originalText = btn.innerHTML;
            btn.innerHTML = "ìƒì„± ì¤‘... (Generating)";
            btn.disabled = true;

            setTimeout(() => {
                const keywords = input.value.split(' ')[0] || "Variation";
                const randomSeed = Math.floor(Math.random() * 999999);
                const width = 1024;
                const height = 768; 
                const newUrl = `https://picsum.photos/seed/${randomSeed}/${width}/${height}`; 
                
                addToHistory(newUrl, `ìˆ˜ì •ë³¸ ${imageHistory.length} (${keywords})`);
                
                input.value = ""; 
                btn.innerHTML = originalText;
                btn.disabled = false;
                
                const container = document.getElementById('historyContainer');
                container.scrollLeft = container.scrollWidth;
                
            }, 1500);
        }

        // 9. ë‹¤ìš´ë¡œë“œ ëª¨ë‹¬ ë° ì‹¤í–‰
        function openDownloadModal() {
            if (currentHistoryIndex === -1) {
                alert("ë‹¤ìš´ë¡œë“œí•  ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
            document.getElementById('downloadModal').classList.remove('hidden');
        }

        function closeDownloadModal() {
            document.getElementById('downloadModal').classList.add('hidden');
        }

        function executeDownload(format) {
            const currentImg = imageHistory[currentHistoryIndex];
            const currentUrl = currentImg.url;
            const fileName = `EduGen_Ver_${currentHistoryIndex + 1}`;

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.crossOrigin = "Anonymous";
            img.src = currentUrl;

            img.onload = () => {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                let downloadUrl;
                let downloadName;

                if (format === 'jpg') {
                    downloadUrl = canvas.toDataURL('image/jpeg', 0.9);
                    downloadName = `${fileName}.jpg`;
                    triggerDownload(downloadUrl, downloadName);

                } else if (format === 'png') {
                    downloadUrl = canvas.toDataURL('image/png');
                    downloadName = `${fileName}.png`;
                    triggerDownload(downloadUrl, downloadName);

                } else if (format === 'ai') {
                    downloadUrl = canvas.toDataURL('image/png'); 
                    downloadName = `${fileName}_Project_Source.png`;
                    alert("âš ï¸ ì•ˆë‚´: AI(ë²¡í„°) íŒŒì¼ ë³€í™˜ì€ ì„œë²„ ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.\ní˜„ì¬ëŠ” í¸ì§‘ ê°€ëŠ¥í•œ ê³ í•´ìƒë„ ì›ë³¸(PNG)ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤.");
                    triggerDownload(downloadUrl, downloadName);
                }
                
                closeDownloadModal();
            };

            img.onerror = () => {
                alert("ì´ë¯¸ì§€ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                closeDownloadModal();
            };
        }

        function triggerDownload(url, name) {
            const link = document.createElement('a');
            link.download = name;
            link.href = url;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
